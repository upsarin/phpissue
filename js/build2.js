function FlowCollection(e){for(var t=0;e[t];t++)this[t]=e[t]}function Flow(e,t){this.inputs={},this.data={},this.outputs={},this.cb=e,this.name=t||Flow.getUid(),this.state=0,this.result=null}function flowPaused(e){var t=new Flow(function(e){return t.resumed?e(t.resume_data):void(t.resume=function(t){e(t)})},e);return t.resumed=!1,t.resume=function(e){t.resume_data=e,t.resumed=!0},t}function flow(e,t){if(e instanceof Flow)return e;var o=new Flow(e,t);return o}function syncflow(e,t){return flow(function(t,o,n){t(e(o,n))},t)}function capitalize(e){return e[0].toUpperCase()+e.slice(1)}function goortb(e,t,o,n,i,s){if(!goortb.script){goortb.script=!0;var r=document.getElementsByTagName("script")[0],a=document.createElement("script");a.type="text/javascript",a.src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",a.async=!0,r.parentNode.insertBefore(a,r)}goortb[t]=goortb[t]?goortb[t]:0;var l=i[goortb[t]],c=[].concat(o),u=[].concat(n),d=c[goortb[t]]||o,h=u[goortb[t]]||n;goortb[t]++;var p=3,f=function(t){var o='<ins class="adsbygoogle" style="display:inline-block;width:'+d+"px;height:"+h+'px"';o=o+' data-ad-client="ca-pub-6077965237125445" data-ad-slot="'+l+'"></ins>',document.getElementById(e).innerHTML=o,(window.adsbygoogle=window.adsbygoogle||[]).push({}),p&&(p--,rtb_refresh(e,function(){f()},s))};f()}function yartb(e,t,o,n,i){var s=function(){"undefined"==typeof n?($("#"+e).closest(".js-parent").parent().remove(),$(window).trigger("height")):require(["js2/nobot/decode"],function(){$("#"+e).closest(".js-parent").parent().replaceWith(nb_get(n)),$(window).trigger("height")}),s=function(){}};!function(n,r,a,l,c){yartb[t]=yartb[t]?yartb[t]:0;var u=o[yartb[t]];if(yartb[t]++,!u)return void jquery(function(){s()});var d=3,h=function(){Ya.Context.AdvManager.render({blockId:u,renderTo:e,async:!0,onRender:function(){jquery(function(){$(document.getElementById(e)).closest(".js-parent").css("height","").parent().css("visibility",""),$(window).trigger("height"),d&&(d--,rtb_refresh(e,function(){h()},i))})}},function(){jquery(function(){s()})})};n[a]=n[a]||[],n[a].push(h),c=r.getElementsByTagName("script")[0],l=r.createElement("script"),l.type="text/javascript",l.src="//an.yandex.ru/system/context.js",l.async=!0,c.parentNode.insertBefore(l,c)}(window,window.document,"yandexContextAsyncCallbacks"),jqready(function(){setTimeout(function(){var t=$("#"+e);t.height()||s()},5e3)})}function rtb_refresh(e,t,o){o&&jquery(function(){var n=$(document.getElementById(e)),i=n.outerHeight(),s=0,r=!1,a=setInterval(function(){var e=$(window).scrollTop(),l=n.offset().top;e-i/2<=l&&e+$(window).height()-i/2>=l&&(r=!0),r&&s++,s>o&&(clearInterval(a),t&&t())},1e3)})}function replaceWindowHash(e){var t=window.location.href.replace(/#(.*)$/,"");t+e!=window.location.href&&(""==e&&t+"#"==window.location.href||(""==e&&""!=window.location.href&&(e="#"),"replaceState"in history?history.replaceState("",document.title,t+e):(scrollV=document.body.scrollTop,scrollH=document.body.scrollLeft,window.location.replace(t+e),document.body.scrollTop=scrollV,document.body.scrollLeft=scrollH)))}function plural(e,t,o,n){if((e%=100)&&(e<11||e>19)&&(e%=10)){if(1===e)return o;if(e<5)return n}return t}FlowCollection.prototype=new Array,FlowCollection.prototype.get=function(e){for(var t=0;this[t];t++)if(e in this[t].data)return this[t].data[e];return null},Flow._uid=0,Flow.getUid=function(){return++Flow._uid},Flow.debug=0,Flow.prototype.execute=function(e){if(0!=this.state)return!1;this.state=1,this.data.args=arguments;var t=this;return setTimeout(function(){t._execute(t.data.args)},0),!0},Flow.prototype.execute_now=function(e){return 0==this.state&&(this.state=1,this.data.args=arguments,void this._execute(e))},Flow.prototype._execute=function(e){if(!_.every(this.inputs,function(e){return 3==e.state}))return void _.each(this.inputs,function(e){0==e.state&&e.execute_now()});if(1!=this.state&&0!=this.state)return!1;this.state=2,Flow.debug&&console.log("_execute",this.name);var t=this,o=function(e){Flow.debug&&console.log("next",t.name),t.result=e,t.state=3,_.each(t.outputs,function(o){o.data[t.name]=e,o._execute(e)}),t.inputs={},t.data={},t.outputs={}};this.cb(o,_.size(this.inputs)<=1?e:null,this.data)},Flow.prototype.andthen=function(e,t){return e instanceof Flow?(Flow.debug&&console.log(this.name+" -> "+e.name),e.inputs[this.name]=this,this.outputs[e.name]=e,e):this.andthen(new Flow(e,t))},Flow.decorateMap=function(e){var t={};return _.each(e,function(e,o){e instanceof Flow&&"number"==typeof e.name?(e.name=o,t[o]=e):"function"==typeof e?t[o]=new Flow(e,o):t[o]=e}),t},define("js2/flow",function(){}),define("js2/Observable",["underscore"],function(e){var t=function(){this.initObservable()};return t.prototype.initObservable=function(){this.__events={}},t.prototype.on=function(e,t){e=e.split(" ");for(var o in e){var n=e[o];this.__events[n]||(this.__events[n]=[]),this.__events[n].push(t)}return this},t.prototype.one=function(e,t){var o=this,n=function(i){t.apply(this,Array.prototype.slice.call(arguments,0)),o.off(e,n)};o.on(e,n)},t.prototype.off=function(t,o){t=t.split(" ");for(var n in t){var i=t[n];this.__events[i]&&(o?this.__events[i]=e.filter(this.__events[i],function(e){return e!=o}):this.__events[i]=[])}return this},t.prototype.trigger=function(t,o){if(!this.__events[t])return this;var n=this,i=Array.prototype.slice.call(arguments,1);e.each(this.__events[t],function(e){return e.apply(n,i),this})},t}),define("js2/env",[],function(){"use strict";var e={is_mobile:!!window.is_mobile,is_ipad:!!window.is_ipad,is_android:!!window.is_android,is_phone:!!window.is_phone,fixed_layout:null,list_scroll:null,filters_scroll:null};return e.is_ipad&&(e.fixed_layout=!0,e.list_scroll="native",e.filters_scroll="native"),e}),define("js2/ZMap3",["./Observable","jquery","underscore","./env","js2/flow"],function(e,t,o,n){function i(e){n.is_mobile||require(["js2/mousewheelLimited"],e)}function s(e){window.nbl_ymaps2_loaded?e():window.nbl_ymaps2_onload_cbs?window.nbl_ymaps2_onload_cbs.push(e):(window.nbl_ymaps2_loaded=!1,window.nbl_ymaps2_onload_cbs=[e],window.nbl_ymaps2_onload=function(){window.nbl_ymaps2_loaded=!0,o.each(window.nbl_ymaps2_onload_cbs,function(e){e()}),window.nbl_ymaps2_onload_cbs=null},requirejs.config({paths:{ymaps:"//api-maps.yandex.ru/2.1/?lang=ru-RU&onload=nbl_ymaps2_onload"},shim:{ymaps:{exports:"ymaps"}}}),require(["ymaps"],function(){},function(){window.navigator.userAgent.toLowerCase().indexOf("firefox")!=-1&&t.post("/js.php",{area:"misc",action:"firefoxProtection"})}))}function r(e){var t=e(window);t.on("z-location-set",function(o,n,i,s){window.Global.user.has_coords=!0,window.Global.user.lat=n[0],window.Global.user.lon=n[1],e.post("/js.php",{area:"profile",action:"location",lat:n[0],lon:n[1]},function(){i&&i(!0),t.trigger("z-location-changed",[s])})}),t.on("z-location-auto",function(e,o,n){return"undefined"==typeof navigator.geolocation?(window.Global.user.has_coords=!0,t.trigger("z-location-manual"),void(n&&n(!1))):void navigator.geolocation.getCurrentPosition(function(e){var i=10;e.coords.accuracy<125e3&&(i=11),e.coords.accuracy<3e4&&(i=12),e.coords.accuracy<3e3&&(i=15,o&&o.close()),t.trigger("z-location-set",[[e.coords.latitude,e.coords.longitude],n,i])},function(){n&&n(!1)},{enableHighAccuracy:!0,timeout:3e3,maximumAge:0})}),t.on("z-location-manual",function(){})}var a=n.is_mobile?64:24,l={default:{center_on_user:!1,center_on_items:!1,center_on_items_and_user:!1,balloon:!0,controls:function(e){},placemark_user:!0,paused:!0,feedback:!1,postpone_map_creation:!1,bounds_adjustment_mode:"default",clusterer:!1,balloonAutoPanMargins:[0,0,0,0]},index:{center_on_user:!0,center_on_items:!0,map_url:"?action=map",paused:!0,bounds_adjustment_mode:"flexible"},catalog:{center_on_items_and_user:!1,bounds_adjustment_mode:"precise",balloon:!0,feedback:!0,paused:!0,center_on_user:!1,center_on_items:!0,clusterer:!0,onBalloonOpen:function(e){this.trigger("balloon_open",e)},balloonAutoPanMargins:[90,34,34,654]},network:{center_on_items:!0,feedback:!0,clusterer:!0,controls:function(e){e.controls.add("zoomControl")}},service:{center_on_items:!0,balloon:!1,bounds_adjustment_mode:"precise",onPlacemarkClick:function(e){this.trigger("point_click",e)}},layer:{center_on_items:!0,balloon:!1,controls:function(e){e.controls.add("zoomControl")},onPlacemarkClick:function(e){this.trigger("point_click",e)}},layer_new:{center_on_items_and_user:!0,feedback:!0,balloon:!0,controls:function(e){e.controls.add("zoomControl")},balloonAutoPanMargins:[20,20,20,20],onPlacemarkClick:function(e){this.trigger("point_click",e)}},lego_network:{center_on_items:!0,feedback:!0,balloon:!1,controls:function(e){e.controls.add("zoomControl")},onPlacemarkClick:function(e){this.trigger("point_click",e)}},my_location:{center_on_user:!0,balloon:!1,controls:function(e){e.controls.add("zoomControl")},placemark_user:!1},platform:{center_on_items:!0,feedback:!0,controls:function(e){e.controls.add("zoomControl")}},prof:{center_on_items:!0,feedback:!0,balloon:!1,controls:function(e){e.controls.add("zoomControl")},onPlacemarkClick:function(e){this.trigger("point_click",e)}}},c=function(r,a){var u=this;this.nodeSelector=r,o.extend(this,new e),this.pushOnReady=function(e){this.is_ready?e():this.one("z-loaded",e)},this.map=null,this.is_ready=!1,this.options=o.extend({},l.default,"string"==typeof a?l[a]:a),this.options.onPlacemarkClick&&(this.onPlacemarkClick=this.options.onPlacemarkClick),this.options.onBalloonOpen&&(this.onBalloonOpen=this.options.onBalloonOpen),this.placemarks={},this.placemark_clicked=null,this.profilePlacemark=null,this.onShowHook=function(){},this.onBalloon_binded=function(e){return u.onBalloon(e)},this.onBalloon_close=function(e){return u.onBalloonClose(e)},this.onHighlight=function(e){var t=e.get("target"),o="mouseenter"==e.get("type"),n=t.properties.get("itemData");t.balloon.isOpen()||(u.highlightItem(n.id,o),u.trigger("z-highlight",n.id,o))},this.getNode=function(){return u.node||t(u.nodeSelector)},this.wheelEnabled=null,this.wheelHard=!1,this.toggleWheel=function(e,t){u.map&&u.wheelEnabled!==e&&(!t&&u.wheelHard||(e?u.map.behaviors.enable("scrollZoom"):u.map.behaviors.disable("scrollZoom"),u.wheelEnabled=e,u.wheelHard=!!t))},this.wheelToScale=function(e){u.toggleWheel(!0,e),u.$zoom&&i(function(){u.$zoom.mousewheelPrevent()})},this.wheelToScroll=function(e){u.toggleWheel(!1,e),u.$zoom&&i(function(){u.$zoom.unmousewheelPrevent()})};var d=Flow.decorateMap({api:function(e){return c.initialized?e():void s(function(){c.initialize(),e()})},jq:flowPaused(),map:syncflow(function(e,t){var o=t.resume;"function"==typeof o&&(o=o()),u.createMap(o),u.is_ready=!0,u.trigger("z-loaded")}),resume:function(e){u.resume=function(t){u.options.paused=!1,e(t)}},dummy:null});d.api.andthen(d.map),d.jq.andthen(d.map),u.flows=d,d.resume.andthen(d.map).execute_now(),u.getStatic=c,jquery(function(){u.node=u.getNode(),d.jq.resume()}),this.removePlacemark=function(e){this.placemarks[e]&&(this.options.clusterer&&this.clusterer.remove([this.placemarks[e]]),delete this.placemarks[e])},this.translateCenter=function(e,t){return e},u.pushOnReady(function(){var e=u.map;e.events.add("click",function(o){var i=o.get("target");n.is_phone&&i===e&&t("#ymaps-balloon").empty(),u.current_balloon&&(u.current_balloon.close(),u.current_balloon=null)}),e.events.add("mousedown",function(e){u.wheelToScale()}),u.node.data("waitingForEnter",!1).on("mouseleave",function(){t(this).data("waitingForEnter",u.wheelEnabled),u.wheelToScroll()}),t("html,body").on("mouseenter",function(e){var o=t(e.target);o.is("ymaps")&&u.node.data("waitingForEnter")&&u.wheelToScale(),u.node.data("waitingForEnter",!1)}),e.events.add("actionbegin",function(e){u.bounds_change_blocks||u.trigger("z-user-interact-begin",e)}),u.on("z-placemark-click z-cluster-click",function(e){u.trigger("z-user-interact-begin",e)})})};c.getStyle=function(e,t){return o.extend({},l[e],t||{})};var u='<svg width="{{ options.size[0] }}" height="{{ options.size[1] }}"><circle cx="{{ options.shape.radius }}" cy="{{ options.shape.radius }}" r="{{ options.r[0] }}" fill="#ffffff" /><circle class="svg-marker-color" cx="{{ options.shape.radius }}" cy="{{ options.shape.radius }}" r="{{ options.r[1] }}" fill="{{ options.color }}" /><circle cx="{{ options.shape.radius }}" cy="{{ options.shape.radius }}" r="{{ options.r[2] }}" fill="#ffffff" /><circle class="svg-marker-color" cx="{{ options.shape.radius }}" cy="{{ options.shape.radius }}" r="{{ options.r[3] }}" fill="{{ options.color }}" /></svg>',d='<svg width="{{ options.clusterIcons[0].size[0] }}" height="{{ options.clusterIcons[0].size[1] }}"><circle cx="{{ options.clusterIcons[0].radius }}" cy="{{ options.clusterIcons[0].radius }}" r="{{ options.clusterIcons[0].r[0] }}" fill="#ffffff" /><circle class="svg-marker-color" cx="{{ options.clusterIcons[0].radius }}" cy="{{ options.clusterIcons[0].radius }}" r="{{ options.clusterIcons[0].r[1] }}" fill="{{ options.clusterIcons[0].color }}" /><circle cx="{{ options.clusterIcons[0].radius }}" cy="{{ options.clusterIcons[0].radius }}" r="{{ options.clusterIcons[0].r[2] }}" fill="#ffffff" /><circle class="svg-marker-color" cx="{{ options.clusterIcons[0].radius }}" cy="{{ options.clusterIcons[0].radius }}" r="{{ options.clusterIcons[0].r[3] }}" fill="{{ options.clusterIcons[0].color }}" />{% if properties.geoObjects.length %}<text transform="translate(0, 1)" text-anchor="middle" dy=".5ex" x="{{ options.clusterIcons[0].radius }}" y="{{ options.clusterIcons[0].radius }}" style="font-family: Arial; font-size: {{ options.clusterIcons[0].fontSize }}; font-weight: bold; fill: {{ options.clusterIcons[0].color }};">{% if properties.geoObjects.length < 100 %}{{ properties.geoObjects.length }}{% else %}99+{% endif %}</text>{% endif %}</svg>';c.initialize=function(){if(!c.initialized){c.initialized=!0;var e={radius:17,fontSize:"11px",r:[17,15,11,5],size:[34,34],offset:[-17,-17],color:"#694caf"};n.is_mobile&&o.extend(e,{radius:25,fontSize:"16px",r:[25,22,16,7],size:[50,50],offset:[-25,-25]});var t=o.extend({},e,{r:e.r.slice(0,-1)}),i={iconLayout:ymaps.templateLayoutFactory.createClass(u),iconShape:{type:"Circle",coordinates:[e.radius,e.radius],radius:e.radius},iconColor:e.color,iconSize:e.size,iconR:e.r,zIndex:2,zIndexActive:3,iconOffset:e.offset};ymaps.option.presetStorage.add("z#cluster",[t]),ymaps.option.presetStorage.add("z#cluster-hover",[o.extend({},t,{color:"#fa4077"})]),ymaps.option.presetStorage.add("z#cluster-dot",[o.extend({},t,{color:"#fa4077",r:[7,5,0,0]})]),ymaps.option.presetStorage.add("z#marker",i),ymaps.option.presetStorage.add("z#marker-hover",o.extend({},i,{iconColor:"#fa4077"})),ymaps.option.presetStorage.add("z#dot",o.extend({},i,{iconColor:"#fa4077",iconR:[7,5,0,0]})),ymaps.option.presetStorage.add("z#profile",{iconLayout:"default#image",zIndex:651,zIndexActive:651,iconImageHref:"/images/map_profile.png?v=2",iconImageSize:[17,48],iconImageOffset:[-9,-47],hideIconOnBalloonOpen:!1,draggable:!0}),ymaps.layout.storage.add("z#placemark",ymaps.templateLayoutFactory.createClass("{{options.contentBodyLayout}}"))}};var h=function(e,t){for(var o,n=e.length,i=0,s=e[0],r=1;r<=n;r++){var a=e[r%n];t[1]>Math.min(s[1],a[1])&&t[1]<=Math.max(s[1],a[1])&&t[0]<=Math.max(s[0],a[0])&&s[1]!=a[1]&&(o=(t[1]-s[1])*(a[0]-s[0])/(a[1]-s[1])+s[0],(s[0]==a[0]||t[0]<=o)&&i++),s=a}return i%2==1};c.prototype.matchPointsBySquare=function(e,t){var o=this.map.options.get("projection"),n=this.map.getZoom(),i=[];for(var s in this.placemarks){var r=this.placemarks[s];r&&i.push({id:s,global_px_coords:o.toGlobalPixels(r.geometry.getCoordinates(),n)})}var a=[],l=o.toGlobalPixels(e,n),c=l[0],u=l[1],d=t;a.push([c-d,u-d],[c+d,u-d],[c+d,u+d],[c-d,u+d]);var p=[],f=this;return i.forEach(function(e){h(a,e.global_px_coords)&&p.push(f.placemarks[e.id].properties.get("itemData").id)}),p},c.prototype.showClusterBalloon=function(e){var i=this.clusterer,s=this;if(this.current_balloon=i.balloon,e.properties.get("balloonContent"))return void i.balloon.open(e);for(var r=e.getGeoObjects(),a=[],l=0;l<r.length;l++)a.push(r[l].properties.get("itemData").id);i.balloon.close(),t.post("/js.php",{area:"service",action:"tooltip",service_ids:a},function(r){n.is_phone?t("#ymaps-balloon").html(r):(e.properties.set("balloonContent",r),n.is_mobile||(e.options.set("balloonAutoPan",!0),e.options.set("balloonAutoPanMargin",s.options.balloonAutoPanMargins)),o.isFunction(s.onBalloonOpen)&&s.onBalloonOpen(e),i.balloon.open(e))})},c.prototype.switchCurrentBalloon=function(e){this.current_balloon&&this.current_balloon!=e&&this.current_balloon.close(),e&&(this.current_balloon=e)},c.prototype.onBalloonClose=function(e){if(this.current_balloon){var o=this.current_balloon;i(function(){var e=o.getOverlaySync(),n=e?t(o.getOverlaySync().getBalloonElement()):null;n&&n.unmousewheelPrevent().data("wheelPrevented",!1)})}},c.prototype.onBalloon=function(e){this.preOnBalloonCallback&&this.preOnBalloonCallback(e);var s=this,r=e.get("target");this.node.addClass("ymballooned");var a=r.balloon;this.switchCurrentBalloon(a);var l=r.properties.get("itemData");return i(function(){var e=t(a.getOverlaySync().getBalloonElement());e.data("wheelPrevented")||e.mousewheelPrevent().data("wheelPrevented",!0)}),this.placemark_clicked=l.id,this.prev_highlighted&&this.placemarks[this.prev_highlighted].events.fire("mouseleave"),t.post("/js.php",{area:"service",action:"tooltip",service_ids:[l.id]},function(e){o.isFunction(s.onBalloonOpen)&&s.onBalloonOpen(r),n.is_phone?t("#ymaps-balloon").html(e):r.properties.set("balloonContent",e)}),!1},c.prototype.hasDimensions=function(){var e=t(this.map.container.getElement()),o=e.width(),n=e.height();return!(!o||!n)},c.prototype.setConSizes=function(e,t){e&&(this.map.container.getElement().style.width=e),t&&(this.map.container.getElement().style.height=t)},c.prototype.getConParentDims=function(){var e=this.node.parent(),t=e.width(),o=e.height();return{width:t,height:o}},c.prototype.updateSize=function(e,t){if(this.map&&this.map.container&&this.map.container.getElement()&&this.hasDimensions()){var o=this.getConParentDims(),n=this.map.getBounds();if(n[0]==n[2]||n[1]==n[3]||o.width!=this.current_width||o.height!=this.current_height){this.current_height=o.height,this.current_width=o.width;var i=this.map.getCenter();this.setConSizes(e,t),this.map.container.fitToViewport(),this.map.setCenter(i)}}},c.prototype.updateSizeNotCenter=function(e,t){this.map&&this.map.container&&this.map.container.getElement()&&this.hasDimensions()&&(this.setConSizes(e,t),this.map.container.fitToViewport(!0))},c.prototype.createClusterer=function(){var e=this;this.clusterer=new ymaps.Clusterer({clusterDisableClickZoom:!0,clusterOpenBalloonOnClick:!1,gridSize:a,zIndex:2,zIndexActive:3,clusterIconContentLayout:ymaps.templateLayoutFactory.createClass(d),clusterBalloonContentLayout:ymaps.templateLayoutFactory.createClass("{{properties.balloonContent|default:properties.hintContent|raw}}")}),this.clusterer.balloon.events.add("open",function(o){e.setClusterPreset(o.get("cluster"),"z#cluster-dot"),i(function(){var o=t(e.clusterer.balloon.getOverlaySync().getBalloonElement()),n=o.find(".balloon-scrolled-block:first");n.data("wheelPrevented")||n.mousewheelLimited().data("wheelPrevented",!0);var i=o.find("ymaps").filter(function(){return!t(this).data("wheelPrevented")});i.mousewheelPreventOnly().data("wheelPrevented",!0)})}),this.clusterer.balloon.events.add("close",function(t){e.setClusterPreset(t.get("cluster"),"z#cluster")}),this.clusterer.balloon.events.add("autopanbegin",function(){e.bounds_change_blocks++}),this.clusterer.balloon.events.add("autopanend",function(){e.bounds_change_blocks--}),this.clusterer.createCluster=function(t,o){var n=ymaps.Clusterer.prototype.createCluster.apply(this,arguments);e.setClusterPreset(n,"z#cluster");var i=[];for(var s in o)i.push(o[s].properties.get("hintContent"));return n.properties.set("hintContent",i.join("<br />")),n.events.add("click",function(t){e.trigger("z-cluster-click",t),e.showClusterBalloon(n)}),n.events.add(["mouseenter","mouseleave"],function(t){"z#cluster-dot"!=n.options.get("preset")&&e.highlightCluster(n,"mouseenter"==t.get("type"))}),n},this.map.geoObjects.add(this.clusterer)},c.prototype.createMap=function(e){var i=this,s={},r={};if(!e)throw Error("no bounds");s=e[0]&&e[1]?ymaps.util.bounds.getCenterAndZoom(e,[this.node.width(),this.node.height()]):o.clone(e),s.zoom>17&&(s.zoom=17),s.behaviors=["drag","dblClickZoom","multiTouch"],s.controls=[],r.autoFitToViewport="none",this.map=new ymaps.Map(this.node[0],s,r),this.options.clusterer&&this.createClusterer(),n.is_mobile&&this.map.controls.remove("zoomControl"),this.options.controls(this.map),this.options.placemark_user&&(this.updateProfile_binded=function(e,t){var o=!1;if(i.profilePlacemark){o=i.profilePlacemark.balloon&&i.profilePlacemark.balloon.isOpen();try{i.map.geoObjects.remove(i.profilePlacemark)}catch(e){}i.profilePlacemark=null}window.Global.user.has_coords&&(i.addProfile(),(t||o)&&i.showProfile(t,o))},t(window).on("z-location-changed",this.updateProfile_binded),this.updateProfile_binded(!1)),this.bounds_change_blocks=0,this.map.events.add("boundschange",function(){0==i.bounds_change_blocks&&i.trigger("z-boundschange")}),this.pushOnReady(function(){var e=i.getConParentDims();i.current_width=e.width,i.current_height=e.height})},c.prototype.showProfile=function(e,t){var o=this;if(!e&&o.profilePlacemark&&o.profilePlacemark.balloon&&t)return void o.profilePlacemark.balloon.open(o.map.getCenter());var n=new ymaps.map.action.Single({center:this.translateCenter(this.profilePlacemark.geometry.getCoordinates(),e||12),zoom:e||12,duration:750,timingFunction:"ease-in",checkZoomRange:!1,callback:function(){t&&o.profilePlacemark.balloon.open(o.map.getCenter()),o.trigger("z-boundschange")}});this.map.action.execute(n)},c.prototype.close=function(){t(window).off("z-location-changed",this.updateProfile_binded)},c.prototype.updateBounds=function(e,t,o){if(o=o||15,e.length)this.setBounds(c.calculatePartialBoundsByObjects(e,this.options.bounds_adjustment_mode));else if("undefined"!=typeof t&&t){var n=ymaps.util.bounds.getCenterAndZoom(t,[this.node.width(),this.node.height()]);n.zoom=n.zoom>=o?o:n.zoom,this.bounds_change_blocks++,this.map.setCenter(this.translateCenter(n.center,n.zoom),n.zoom),this.bounds_change_blocks--}else{var i=this.map.getZoom()-3;this.bounds_change_blocks++,this.map.setZoom(i<=9?9:i),this.bounds_change_blocks--}},c.prototype.update=function(e){if(!this.options.items_dynamic)throw new Error("cannot reload");if(this.is_ready){var t=this;t.loadObjects(function(o){t.updateObjects(o.items),e&&t.options.center_on_items&&t.updateBounds(o.items,o.bounds)},!1)}},c.prototype.addProfile=function(){var e=this,o=new ymaps.Placemark([1*window.Global.user.lat,1*window.Global.user.lon],{balloonContent:'Если местоположение определено некорректно, кликните на <a href="#" class="js-location-auto">переопределить</a> или задайте его вручную, переместив эту метку на карте.',hintContent:"Это вы. Кликните, если вы в другом месте"},{preset:"z#profile"});o.events.add("dragend",function(e){var n=o.geometry.getCoordinates();t(window).trigger("z-location-set",[n,null,!1])}),o.events.add("balloonopen",function(o){var n=o.get("target"),i=n.balloon,s=t(i.getOverlaySync().getBalloonElement());e.node.removeClass("ymballooned"),e.switchCurrentBalloon(i),s.find(".js-location-auto").on("click",function(e){e.preventDefault(),t(window).trigger("z-location-auto",[i])}),s.find(".js-location-manual").on("click",function(e){e.preventDefault(),t(window).trigger("z-location-manual"),i.close()})}),this.map.geoObjects.add(o),this.profilePlacemark=o},c.prototype.runLocationAuto=function(e){var o=this;t(window).trigger("z-location-auto",[null,function(t){o.pushOnReady(function(){t&&(o.profilePlacemark||o.addProfile(),o.showProfile(null,!0)),e&&e(t)})}])},c.prototype.getPreset=function(e,t){return"z#marker"},c.prototype.updateObjects=function(e){var t={},i={},s=this;for(var r in this.placemarks)r!=this.placemark_clicked?i[r]=this.placemarks[r]:t[r]=this.placemarks[r];this.placemarks=t;for(var a=[],l=[],r=e.length-1;r>=0;r--){var c=e[r];if((!c.id||c.id!=this.placemark_clicked)&&c.lonlat){var u=this.getPreset(c,r);if(i[c.id]&&"object"==typeof i[c.id]){var d=i[c.id];delete i[c.id],this.placemarks[c.id]=d,this.setPlacemarkPreset(d,u),d.properties.set("itemData",c)}else{var h={};n.is_mobile||(h={balloonAutoPan:!0,balloonAutoPanMargin:this.options.balloonAutoPanMargins});var d=new ymaps.Placemark([c.lonlat[1],c.lonlat[0]],{balloonContent:this.options.balloon?c.name:void 0,hintContent:c.name,itemData:c},h);this.setPlacemarkPreset(d,u),d.properties.set("itemData",c),this.options.balloon&&(n.is_phone?(d.options.set("openBalloonOnClick",!1),d.events.add("click",this.onBalloon_binded)):(d.events.add("balloonopen",this.onBalloon_binded),d.events.add("balloonopen",function(e){s.setPlacemarkPreset(e.get("target"),"z#dot")}),d.events.add("balloonclose",function(e){s.onBalloon_close(e);var t=e.get("target");s.setPlacemarkPreset(t,s.getPreset(t.properties.get("itemData")))})),d.balloon.events.add("autopanbegin",function(){s.bounds_change_blocks++}),d.balloon.events.add("autopanend",function(){s.bounds_change_blocks--})),this.options.feedback&&d.events.add(["mouseenter","mouseleave"],this.onHighlight),this.options.clusterer?a.push(d):this.map.geoObjects.add(d),this.placemarks[c.id]=d,function(e){d.events.add("click",function(t){s.trigger("z-placemark-click",t,e),o.isFunction(s.onPlacemarkClick)&&s.onPlacemarkClick(e)})}(c)}}}if(this.options.clusterer){for(var r in i)l.push(i[r]);this.clusterer.remove(l),this.clusterer.add(a)}else for(var r in i)this.map.geoObjects.remove(i[r])},c.prototype.getBounds=function(){var e=this.map?this.map.getBounds():null;return e?[e[0][1],e[0][0],e[1][1],e[1][0]]:null},c.prototype.setPlacemarkPreset=function(e,t){var o=e.options;o.get("preset")!=t&&(o.set("preset",t),o.set("preset0",t),o.set("preset1",t+"-hover"))},c.prototype.setClusterPreset=function(e,t){var o=e.options;o.get("preset")!=t&&(o.set("clusterIcons",ymaps.option.presetStorage.get(t)),o.set("preset0",ymaps.option.presetStorage.get(t)),o.set("preset1",ymaps.option.presetStorage.get(t+"-hover")),o.set("preset",t))},c.calculateBoundsByObjects=function(e){for(var t=1e4,o=-1e4,n=1e4,i=-1e4,s=0;s<e.length;s++)e[s].lonlat&&(t=Math.min(t,e[s].lonlat[0]),o=Math.max(o,e[s].lonlat[0]),n=Math.min(n,e[s].lonlat[1]),i=Math.max(i,e[s].lonlat[1]));return[[n,t],[i,o]]},c.expandBounds=function(e,t){return[[e[0][0]-t,e[0][1]-t],[e[1][0]+t,e[1][1]+t]]};var p=function(e,t){for(var o=0,n=[0,0],i=0;i<e.length;i++){var s=e[i].lonlat;s&&s[1]>=t[0][0]&&s[1]<=t[1][0]&&s[0]>=t[0][1]&&s[0]<=t[1][1]&&(o++,n[0]+=s[1],n[1]+=s[0])}return[o,[n[0]/o,n[1]/o]]};return c.calculatePartialBoundsByObjects=function(e,t){if(0==e.length)return null;var o;o="precise"==t?e.length>150?.8:e.length>100?.9:e.length>50?.95:1:"flexible"==t?e.length>=50?.15:1:e.length>=50?.8:1;var n=c.calculateBoundsByObjects(e);if(1==o)return c.expandBounds(n,.003);for(var i=[(n[1][0]+n[0][0])/2,(n[1][1]+n[0][1])/2],s=[Math.abs(n[1][0]-n[0][0])/2,Math.abs(n[1][1]-n[0][1])/2],r=1,a=0;s[0]>0&&s[1]>0&&(r<.95*o||r>1.05*o)&&a<20;){s=r>1.05*o?[.8*s[0],.8*s[1]]:[s[0]/.9,s[1]/.9];var l=p(e,[[i[0]-s[0],i[1]-s[1]],[i[0]+s[0],i[1]+s[1]]]);r=l[0]/(1*e.length),l[0]&&(i=l[1]),a++}return[[i[0]-s[0],i[1]-s[1]],[i[0]+s[0],i[1]+s[1]]]},c.prototype.setBounds=function(e,t){if(!this.is_ready)throw new Error("map not ready");if(null==e)return!1;if(this.bounds_change_blocks++,t&&t.duration){var o=t.callback,n=this;t.callback=function(){o&&o(),n.bounds_change_blocks--},this.map.setBounds(e,t)}else this.map.setBounds(e,t),this.bounds_change_blocks--;return!0},c.prototype.setCenterAndZoom=function(e,t){return this.bounds_change_blocks++,this.map.setCenter(e,t),this.bounds_change_blocks--,!0},c.prototype.highlightItem=function(e,t){var o=this.placemarks[e];if(o&&0!=o.properties.get("itemData").type.indexOf("point")){if(t){if(this.prev_highlighted==e)return;this.prev_highlighted&&this.highlightItem(this.prev_highlighted,!1),this.prev_highlighted=e}else this.prev_highlighted==e&&(this.prev_highlighted=null);if(this.options.clusterer){var n=this.clusterer.getObjectState(o);n.isClustered&&this.highlightCluster(n.cluster,t)}t?o.options.set("preset",o.options.get("preset1")):o.options.set("preset",o.options.get("preset0"))}},c.prototype.highlightCluster=function(e,t){e&&(t?e.options.set("clusterIcons",e.options.get("preset1")):e.options.set("clusterIcons",e.options.get("preset0")))},c.prototype.getZoom=function(){return this.map&&this.map.getZoom?this.map.getZoom():null},c.prototype.setZoom=function(e,t){return this.map&&this.map.setZoom?this.map.setZoom(e,t):null},c.prototype.getZoomRange=function(){return this.map&&this.map.zoomRange?this.map.zoomRange:null},c.prototype.getCenter=function(){return this.map&&this.map.getCenter?this.map.getCenter():null},c.prototype.toggleZoomControl=function(e){this.map&&this.map.controls&&(e?this.map.controls.add("zoomControl"):this.map.controls.remove("zoomControl"))},c.prototype.initByPoints=function(e){var t=this;e.length&&(t.pushOnReady(function(){t.updateObjects(e)}),t.resume(function(){return c.calculatePartialBoundsByObjects(e,t.options.bounds_adjustment_mode)}))},require(["jquery"],r),c}),define("js2/Cookie",[],function(){var e={};return e.set=function(e,t,o,n,i,s){if(!e||!t)return!1;var r=e+"="+encodeURIComponent(t),a=o?new Date((new Date).getTime()+1e3*o).toGMTString():0;return r+="; path="+(n||"/"),r+="; expires="+a,i&&(r+="; domain="+i),s&&(r+="; secure"),document.cookie=r,!0},e.get=function(e){var t="(?:; )?"+e+"=([^;]*);?",o=new RegExp(t);return!!o.test(document.cookie)&&decodeURIComponent(RegExp.$1)},e.remove=function(e,t,o){return this.set(e,1,-1,t,o),!0},e}),"undefined"==typeof window.console&&(window.console={},window.console.log=function(){}),"function"==typeof define&&define.amd&&define("js2/misc",[],function(){}),define("js2/Toggler",["jquery","./Observable","underscore"],function(e,t,o){return function(n,i,s,r){function a(t,o){d=t||!1,i[d?"show":"hide"](),e(document)[d?"on":"off"]("click.toggler",f),r.closeOnEsc&&e(window)[d?"on":"off"]("keyup.toggler",g),c.trigger("toggle",d),o&&o(d)}var r=r||{},l=r.follow_button_position||!1,c=this,u=!1,d=r.visible||!1,h=r.exclude||null,p=r.include||null;o.extend(c,new t),l&&i.addClass("pos-by-button-center");var f=function(t){var o=e(t.target);(o.closest(n).length||o.closest(i).length||o.closest(p).length)&&!o.closest(h).length||(r.preventDefault&&t.preventDefault(),a(!1)),u||(s&&s(i),u=!0)},g=function(e){var t=parseInt(e.keyCode||e.which,10);27==t&&c.setVisible(!1)};n.on("click.togglers",function(e){e.preventDefault(),!d&&l&&i.css("left",n.outerWidth()/2+n.offset().left),a(!d)}),c.opener=n[0],c.opened=i[0],c.setVisible=a}}),define("js2/Headroom",["jquery"],function(e){var t=function(e){this.node=e,this.fixed=!1};return t.prototype={init:function(){var t,o=this,n=200,i=45,s=0,r=0;o.$node=e(o.node),i=o.$node.height(),r=s=e(window).scrollTop(),e(window).on("scroll.headroom",function(s){var a=e(window).scrollTop(),l=a>=r?"down":"up",c=0;return r=a,o.fixed||a<=i?(c=0,void o.$node.stop(!0,!0).removeClass("hide").css({top:c})):void(t!=l&&("up"==l?(c=0,o.$node.stop().removeClass("hide").animate({top:c},n)):"down"==l&&(c=i*-1,o.$node.stop().animate({top:i*-1},n,function(){o.$node.addClass("hide")})),t=l))})},setFixed:function(e){this.fixed=e}},t}),define("js2/Suggest",["jquery","underscore","./Observable"],function(e,t,o){var n=function(e){this.node=e,t.extend(this,new o),this.init()};return n.prototype={init:function(){var o,n=this,i={},s=0,r=100;n.state={index:-1,text:n.node.value,items:[]},n.$node=e(n.node),n.$form=n.$node.closest("form"),n.$controls=e(".controls",n.$form),n.$balloon=e("<div/>",{id:"suggest"+ +new Date,class:"suggest-search hide"}).appendTo(document.body),n.$node.on("blur keyup",function(e){this.value.length?n.$form.addClass("active"):n.$form.removeClass("active");
}),n.$node.on("keyup.suggest",t.debounce(function(t){var a=parseInt(t.keyCode||t.which,10),l=this.value;if(38!=a&&40!=a&&13!=a){if(l.length<=2)return void n.$balloon.addClass("hide");if(i.hasOwnProperty(l))return void n.update(i[l]);o&&o.reject(),o=e.Deferred(),o.done(function(e){n.update(e)}),e.ajax({url:n.$form.attr("action"),type:"post",data:{action:"suggestions",query:l},dataType:"html",success:function(t){t&&(s>r&&(i={},s=0),s++,i[l]={html:t,items:e("<div />").html(t).find("li").map(function(){return e(this).text()})},o.resolve(i[l]))},error:function(){n.$balloon.addClass("hide")}})}},150)),n.$node.on("keydown.suggest",function(e){var t=parseInt(e.keyCode||e.which,10);13==t?n.hideBalloon():38==t?(e.preventDefault(),n.selectItem(n.state.index-1)):40==t&&(e.preventDefault(),n.selectItem(n.state.index+1))}),n.$node.on("focus.suggest",function(e){n.trigger("change.focus",!0),n.$form.addClass("focus"),i.hasOwnProperty(this.value)&&n.$balloon.removeClass("hide")}),n.$node.on("blur.suggest",function(e){n.trigger("change.focus",!1)}),n.$balloon.on("click.suggest",".suggest-item",function(t){n.selectItem(e(".suggest-item",n.$balloon).index(this)),n.hideBalloon()}),n.$controls.on("click.reset","[type=reset]",function(e){e.preventDefault(),n.$form.removeClass("active"),n.$node.val("").focus(),n.update()}),e(window).on("resize.suggest",function(){var t=n.$node.offset();n.$balloon.css({position:"fixed",width:n.$node.outerWidth(),top:t.top-e(window).scrollTop()+n.$node.outerHeight(!0),left:t.left})}).trigger("resize.suggest"),e("body").append(n.$balloon)},getIndex:function(t){var o=this;return void 0==t?o.state.index:(t+e(".suggest-item",o.$balloon).length+1)%(e(".suggest-item",o.$balloon).length+1)},selectItem:function(t){var o=this;o.state.index=o.getIndex(t),e(".suggest-item",o.$balloon).removeClass("hover").eq(o.state.index).addClass("hover"),o.state.index==o.state.items.length?o.$node.val(o.state.text):o.$node.val(o.state.items[o.state.index])},hideBalloon:function(){var e=this;e.$balloon.addClass("hide"),e.$form.removeClass("focus")},update:function(t){var o=this;t=t||{},o.state={text:o.node.value,index:-1,items:t.items||[]},o.$balloon.empty().append(t.html||"").removeClass("hide"),e(document).off("click.suggestBalloon").on("click.suggestBalloon",function(t){var n=e(t.target);n.closest(o.$node).length||n.closest(o.$balloon).length||(o.hideBalloon(),e(document).off("click.suggestBalloon"))})}},n}),define("js2/headerController",["jquery","underscore","js2/Cookie","js2/Toggler","js2/Headroom","js2/Suggest"],function(e,t,o,n,i,s){function r(t,o){var n=this,r={node:e(t)||e("#header"),container:e(".header-container",n.node),nodeHeight:e(t).height(),activeClass:"active"};e.extend(n,r,o||{}),n.headroom=new i(n.container[0]);var a=new s(document.getElementById("search_input"));return a.on("change.focus",function(e){n.headroom.setFixed(e)}),window.headerHeight=0,e("body").hasClass("headroom-disabled")?(n.container.css("position","relative"),n):(n.headroom.init(),n)}return r.prototype={init:function(e){var t=this;return t.categories(),t.cities(),t.userMenu(),e&&e(),t},categories:function(){var t=this,o=e(".header-category",t.node),i=e(".box-header-category",t.node),s=new n(o,i,function(){e.get("/js.php",{area:"header",action:"categories",city:t.city},function(o){e(".categories-list",t.node).html(o)})},{preventDefault:!0,closeOnEsc:!0});return s.on("toggle",function(n){e(window).trigger("track-event",["menu",n?"open":"close"]),o[n?"addClass":"removeClass"](t.activeClass),t.headroom.setFixed(n)}),o.data("z-toggle",s),t.node.on("click",".category-sort-control .button",function(o){o.preventDefault();var n=e(this),i=n.data("sort");e(window).trigger("track-event",["menu","select",i]),e(".category-sort-control .button").removeClass(t.activeClass),n.addClass(t.activeClass),e(".category-sort-toggle",t.node).hide().filter(".categories-sort-"+i).show()}),t},cities:function(){var t=this,o=e(".header-city",t.node),i=e(".box-header-city",t.node),s=new n(o,i,function(){e.get("/js.php",{area:"header",action:"cities"},function(o){e(".city-changer",t.node).html(o),t.groupCountries()})},{preventDefault:!0,closeOnEsc:!0});return s.on("toggle",function(e){o[e?"addClass":"removeClass"](t.activeClass),t.headroom.setFixed(e)}),o.data("z-toggle",s),t},toggleUsermenu:function(t,n){var i=this;return t?o.remove("hide_usermenu"):o.set("hide_usermenu",1,0),e(".user-menu",i.node).animate({width:t?"show":"hide"},function(){n&&n(t)}),i},userMenu:function(){var t=this,n=e(".account-settings",t.node),i=e(".avatar",n),s=e(".login",t.node);return i.on("click",function(e){e.preventDefault(),t.toggleUsermenu(o.get("hide_usermenu"))}),s.on("click",function(e){e.preventDefault(),create_layer("auth")}),t},groupCountries:function(){var t=this,o=e(".group-country",t.node),n=280;return o.each(function(t){var i=e(this),s=o.eq(t+1);return i.hasClass("empty")?void i.remove():void(s.length&&i.height()+s.height()<n&&(i.append(s.html()),s.addClass("empty")))}),t}},r}),define("js2/SearchSuggest",["jquery","./Observable","underscore"],function(e,t,o){function n(n,i){function s(t){var o=e("li",m),n=o.filter(".keyhover");if(n.length){n.removeClass("keyhover");var i=o.index(n)-t;i<0?i=o.length-1:i>=o.length&&(i=0),e(o.get(i)).addClass("keyhover")}else 1!=t&&t!=-1||o[1==t?"last":"first"]().addClass("keyhover");var s=o.filter(".keyhover"),r=o.index(s);m[0].scrollTop=33*r}function r(){var t=e("li.keyhover a",m);e("li",m);e(window).trigger("track-event",["search","click"]),setTimeout(function(){t.length&&(window.location.href=t.attr("href"))},50)}function a(t){l(),e(window).on("resize.suggest",l),m.html(t).show(),e("li:first",m).addClass("keyhover"),c.trigger("change.focus",!0)}function l(){var t=h.offset(),o={position:"absolute",width:h.outerWidth(!0)};u.fixed&&(o.position="fixed",o.top=t.top-e(window).scrollTop()+h.outerHeight(!0),o.left=t.left),m.css(o)}var c=this,u=e.extend({fixed:!0},i);o.extend(c,new t);var d,h=e(n),p=(h.closest("form"),{}),f=0,g=100,m=e("<div/>",{id:"suggest"+ +new Date,class:"search-res"});h.on("keyup change",function(e){var t=parseInt(e.keyCode||e.which,10);38!=t&&40!=t&&13!=t&&(d=h.val(),v())}),h.on("keydown",function(t){var o=parseInt(t.keyCode||t.which,10);13==o?(t.preventDefault(),e("li",m).removeClass("keyhover"),s(1),r()):38==o?(t.preventDefault(),s(1)):40==o&&(t.preventDefault(),s(-1))}),h.on("focus",function(){c.trigger("change.focus",!0)}).on("blur",function(){c.trigger("change.focus",!1)}),e(document).on("click.suggest",function(t){$t=e(t.target),$t.closest(h).length||$t.closest(e(".search-res")).length||(m.hide(),d="",e(window).off("resize.suggest"))});var v=o.debounce(function(){if(!d)return void m.hide();if(!(d.length<2)){if(p[d])return void a(p[d]);var t={action:"suggestions",query:d};e(window).trigger("track-event",["search","suggest"]),e.post("/search/",t,function(e){m.hide(),""!=e&&(f>g&&(p={},f=0),p[t.query]=e,f++,a(e))})}},250);docready(function(){u.fixed?e("body").append(m):m.insertAfter(h),m.on("click","li",function(e){e.preventDefault(),r()}),m.on("mouseenter","li",function(){e("li",m).removeClass("keyhover"),e(this).addClass("keyhover")})})}return n}),define("js2/StatHelper",["jquery"],function(e){var t,o;return window.ga&&ga(function(e){void 0!==e&&(t=e.get("clientId"),o=e.get("trackingId"))}),function(n,i){var s=i.stat_label||null,r=i.object_type||"organization",a=i.object_id||null;e(window).trigger("track-event",[r,n,s]),"ab_test_gettable_1402"===i.track_tag&&e(window).trigger("track-event",["ab_test",r,n]),"show_phone"==n&&i.isabctest&&e(window).trigger("track-event",["abc_test_snippet","show_phone"]),a&&require(["js2/StatService"],function(e){e({action_type:n,object_type:r,label:s,clientId:t,trackingId:o,sourceType:i.source_type,trackTag:i.track_tag,orgId:i.org_id},function(e){e&&e(a)})})}}),define("js2/phoneController",["jquery","js2/StatHelper"],function(e,t){var o=!1;return function(n){e(document).off("touchstart.phone click.phone").on("touchstart.phone click.phone",".js-phone",function(i){var s=e(this),r=s.closest(".js-phone-holder"),a=s.data("json");"object"!=typeof a&&(a=e.parseJSON(a)),n?o||(o=!0,setTimeout(function(){o=!1},300),t("call_phone",a)):(i.preventDefault(),s.hasClass("phone-hidden")&&(r.length?e(".js-phone",r).each(function(){var t=e(this);t.hasClass("phone-hidden")&&(e(".js-phone-number",t).text(t.data("number")),t.removeClass("phone-hidden").addClass("phone-showed"))}):(e(".js-phone-number",s).text(s.data("number")),s.removeClass("phone-hidden").addClass("phone-showed")),e(window).trigger("z-show-phone height"),t("show_phone",a),a.isabtestlayerphone&&(e(window).trigger("track-event",["ab_test_layerphone","show_phone"]),"variation"===a.abtestlayerphoneGroup&&create_layer("phone",{parameters:{org_id:a.abtestlayerphoneOrgid}}))))}),n&&e(".js-phone").addClass("callto")}}),define("js2/StatService",["jquery"],function(e){return function(t,o){function n(t,o){var n=e(this).data("id")||t,a=e(this).data("type")||o||c.object_type;r[a]||(r[a]=[]),n&&r[a].push(n);var u=e.extend({},c,{object_type:a});r[a].length>=s&&i(u),clearTimeout(l[a]),l[a]=setTimeout(function(){i(u)},1e3)}function i(t){var o=t.object_type;r[o]&&r[o].length&&a[o]!==!1&&(a[o]=!1,t.ids=r[o].splice(0,s),e.post("/stat.php",t,function(e){a[o]=!0}),window.za&&za({ev_type:"stat",ev_category:t.action_type||null,object_type:o||null,object_id:t.ids||null}))}t=t||{};var s=20,r={},a={},l={},c=e.extend({area:"stat",object_type:"organization",action_type:""},t);o&&o(n)}}),define("js2/LinksMaker",["jquery"],function(e){function t(t){var o=e("a[data-js-lnk]",t);o.each(function(){e(this).attr("href",e(this).data("js-lnk"))})}return t}),define("js2/customSelect",["jquery","js2/Toggler","myScrollPane"],function(e,t,o){var n=function(t,o){var n=o||{},i={options:{},exclude:{},onInit:function(){},onChange:function(){},onToggle:function(){}};this.node=t,e.extend(this,i,n),this.init()};return n.prototype={refresh:function(){var e=this;e.$node.hasClass("customized")&&(e.value_old=null,e.$ul.empty(),e.getOptions().createList(),e.$node.addClass("customized"))},init:function(){var o=this;if(o.$node=e(o.node),o.$select=e("select",o.$node).hide(),o.$select.length&&!o.$node.hasClass("customized"))return o.$ul=e("<ul/>").hide(),o.getOptions().createList().createButton(),o.$node.append(o.$button),o.$node.append(o.$ul),o.toggler=new t(o.$button,o.$ul,function(e){o.$ul.myScrollPane({scrollable:!0})},{exclude:o.exclude}),o.toggler.on("toggle",function(e){o.$button[e?"addClass":"removeClass"]("active dropped"),o.onToggle.call(o,o.getValue(),e)}),o.$ul.on("click","li",function(t){var n=e(this),i=n.data("key");n.hasClass("selected")||(o.options[i].href||t.preventDefault(),o.$select.val(i).trigger("change"),o.toggler.setVisible(!1))}),o.$select.on("change",function(t){if(o.value_old!=this.value){o.value_old=this.value;var n=o.getValue(),i=o.getIndex();e("li",o.$ul).removeClass("selected").eq(i).addClass("selected"),o.$current.text(o.options[n].title),o.onChange.call(o,n,i)}}),o.$node.addClass("customized"),o.onInit.call(o,o.getValue()),o},getOptions:function(){var t=this;return t.options={},e("option",t.$select).each(function(o){t.options[this.value]={key:this.value,value:e(this).text(),descr:e(this).data("descr"),title:e(this).data("title")||e(this).text(),href:!!this.value.match(/^(http|https|ftp|ftps|#)+/),selected:!!e(this).attr("selected"),visible:"undefined"==typeof e(this).data("visible")||!!e(this).data("visible")}}),t},getValue:function(){var t=this,o=t.$select.val();return null!==o&&void 0!==o||(o=e("option",t.$select).eq(0).val()),o},setValue:function(t){var o=this;o.$select.val(t),o.getValue()||e("option",o.$select).eq(0).attr("selected","selected"),o.$select.trigger("change")},getIndex:function(){var t=this;return e("option",t.$select).filter(function(){return this.value==t.getValue()}).index()},createList:function(){var t=this;for(var o in t.options){var n=[];t.options[o].selected&&n.push("selected"),t.options[o].visible||n.push("hidden");var i=e("<li/>",{"data-key":t.options[o].key,class:n.join(" ")});t.options[o].href?i.append(e("<a />",{href:t.options[o].key,text:t.options[o].value})):i.text(t.options[o].value),t.options[o].descr&&i.prepend(e('<div class="descr"></div>').text(t.options[o].descr)),t.$ul.append(i)}return t},createButton:function(){var t=this;return t.$button=e(".button",t.$node),t.$current=e(".button .current",t.$node),t.$current.length||(t.$current=e("<span/>",{class:"current",text:t.options[t.getValue()].value})),t.$button.length||(t.$button=e("<span/>",{class:"button button-silver"})),t.$button.append(t.$current),t}},n}),define("js2/BannerCode",["jquery","underscore"],function(e,t){var o=function(t,o){var n=o||{},i={url:"",node:t,$node:e(t)};e.extend(this,i,n),this.init()};return o.prototype={init:function(){var o=this;return!!o.$node.length&&(o.check_binded=t.throttle(t.bind(o.check,o),100),e(window).on("scroll.banners resize.banners height.banners",o.check_binded),void o.check())},check:function(){var t=this,o=e(window).scrollTop(),n=t.$node.offset().top,i=e(window).height(),s=t.$node.outerHeight();return!(o+i<=n||o>n+s)&&(t.destroy(),e.post(t.url,function(e){e.success&&(t.node.href=e.click_url)},"json"),!0)},destroy:function(){var t=this;e(window).off("scroll.banners resize.banners height.banners",t.check_binded)}},o}),define("js2/BannerSlidesController",["jquery"],function(e){e.extend(e.easing,{def:"easeOutQuint",easeOutQuint:function(e,t,o,n,i){return n*((t=t/i-1)*t*t*t*t+1)+o}});var t=function(t,o){var n=o||{},i={node:t,show:!0,ready:!0,current:0,slides:[],imageOpacity:.5,timeout:3e3,timeouts:{menu:3e3,offer:3e3,photo:350,comment:5e3,info:3e3},zIndex:5,duration:850,effect:"easeOutQuint",activeClass:"active",isVertical:!1};e.extend(this,i,n),this.init()};return t.prototype={init:function(){var t=this;t.$node=e(t.node),t.$slides=e(".slide",t.$node),t.$image=e(".image",t.$node),t.$slides.each(function(o){var n=e(this).data("slide");t.slides.push(n)}),t.isVertical?t.calcFontSize():t.initHorizontal(),t.slide();var o=t.$node.closest(".service-box-white");o.find(".banner-close").on("click.close",function(n){n.preventDefault(),o.slideUp("fast",function(){e(window).trigger("height"),t.show=!1})})},slide:function(){var e=this,t=e.slides[e.current]||"";return e.show?void setTimeout(function(){e[e.isVertical?"slideVertical":"slideHorizontal"](e.current+1,function(){e.slide()})},e.timeouts[t]?e.timeouts[t]:e.timeout):void e.$node.remove()},getIndex:function(e){var t=this;return void 0==e?t.current:(e+t.slides.length)%t.slides.length},initHorizontal:function(){var t=this,o=e(".box-text-container",t.$node),n=t.calcTextRows(e(".rb40",o));o.addClass("box-text-rows"+n),t.needFade()},slideHorizontal:function(t,o){var n=this,i=n.$node.find(".superbox-overlay").width();return n.current=n.getIndex(t),!!n.ready&&(n.ready=!1,"comment"==n.slides[n.current]?(n.$image.animate({opacity:n.imageOpacity},n.duration/2),void n.$slides.eq(n.current).addClass(n.activeClass).hide().css({left:0}).fadeIn(function(){n.ready=!0,o&&o()})):("comment"!=n.slides[n.getIndex(n.current-1)]&&(n.$image.css("opacity",1),n.$slides.stop().animate({left:i*-1+"px"},n.duration,n.effect,function(){e(this).removeClass(n.activeClass)})),void n.$slides.eq(n.current).addClass(n.activeClass).css({left:i+"px","z-index":n.zIndex++}).stop().animate({left:0},n.duration,n.effect,function(){n.ready=!0,o&&o()})))},slideVertical:function(t,o){var n=this,i=n.$node.find(".superbox-overlay").height();return n.current=n.getIndex(t),!!n.ready&&(n.ready=!1,"comment"==n.slides[n.current]?(n.$image.animate({opacity:n.imageOpacity},n.duration/2),void n.$slides.eq(n.current).addClass(n.activeClass).hide().css({top:0}).fadeIn(function(){n.ready=!0,o&&o()})):("comment"!=n.slides[n.getIndex(n.current-1)]&&(n.$image.css("opacity",1),n.$slides.stop().animate({top:i*-1+"px"},n.duration,n.effect,function(){e(this).removeClass(n.activeClass)})),void n.$slides.eq(n.current).addClass(n.activeClass).css({top:i+"px","z-index":n.zIndex++}).stop().animate({top:0},n.duration,n.effect,function(){n.ready=!0,o&&o()})))},calcFontSize:function(){var t=this,o=e(".name-body",t.$node),n=t.$node.width()-35;o.each(function(o){var i=e(this),s=i.closest(".box-colored").css("max-width",1e3),r=s.find(".name-head"),a=(s.find(".fade").hide(),i.width()),l=parseInt(i.css("font-size"));l>18&&n<a&&(i.add(r).css("font-size",l-3),t.calcFontSize())})},calcTextRows:function(t){var o=e(t),n=parseInt(o.css("line-height")),i=parseInt(o.height());return Math.ceil(i/n)},needFade:function(){var t=this,o=.65*t.$node.width();e(".box-colored",t.$node).each(function(){var t=e(this),n=t.find(".fade"),i=t.outerWidth();i<o&&n.hide()})}},t});